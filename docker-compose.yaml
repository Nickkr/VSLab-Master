version: '3.2'
services:
  api-docs:
    image: gcr.io/api-console-a6952/app:0.1.0
    volumes:
      - './documentation:/app/api'
    ports:
      - '8080:8080'
    environment:
      API_PROJECT: api.raml
      API_TYPE: RAML 1.0
      API_MIME: application/raml
  product:
    build:
      context: ./CoreServices
      args:
        PORT: 18081
        FOLDER: Product
    networks:
      - local_dev_net
    ports:
      - '18081:18081'
    depends_on:
      - db
      - eureka-server
  category:
    build:
      context: ./CoreServices/Category
      dockerfile: ./BuildFromExecutableJar.dockerfile
      args:
        PORT: 18082
        FOLDER: .
    ports:
      - '18082:18082'
    networks:
      - local_dev_net
    depends_on:
      - db
      - eureka-server
  user:
    build:
      context: ./CoreServices
      args:
        PORT: 18083
        FOLDER: User
    networks:
      - local_dev_net
    ports:
      - '18083:18083'
    depends_on:
      - db
      - eureka-server
  product-category-composite-service:
    build: ./CompositeService
    networks:
      - local_dev_net
    ports:
      - '18084:18084'
  eureka-server:
    build:
      context: ./Eureka
      args:
        PORT: 8761
    networks:
      local_dev_net:
        aliases:
          - eureka
    ports:
      - '8761:8761'
  zuul-server:
    build: ./Zuul
    networks:
      local_dev_net:
        aliases:
          - zuul
    ports:
      - '8081:8081'
  db:
    build: ./db
    volumes:
      - './.data/db:/var/lib/mysql'
    environment:
      LANG: C.UTF-8
      MYSQL_ROOT_PASSWORD: c8de110f37300a53a971749
    ports:
      - '3306:3306'
    networks:
      local_dev_net:
        aliases:
          - database
networks:
  local_dev_net:
    driver: bridge
